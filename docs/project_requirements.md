# dolphin_wxbot 项目需求文档

## 项目概述

**项目名称**: dolphin_wxbot (微信智能机器人)  
**版本**: V2.0.0  
**作者**: dolphi  
**开发语言**: Python  
**核心技术**: wxauto/wxautox + 多平台AI API集成  

## 产品定位与目标

### 核心定位
dolphin_wxbot 是一个基于 wxauto 的智能微信机器人系统，旨在为用户提供：
- **智能对话服务**: 集成多个AI平台，提供智能回复功能
- **多消息类型处理**: 支持文本、语音、图片、文件等多种消息类型的智能处理
- **灵活配置管理**: 现代化UI界面，支持多API配置和监听规则管理
- **企业级应用**: 支持群组管理、权限控制、异步处理等企业级功能

### 目标用户
1. **个人用户**: 需要智能助手处理微信消息的用户
2. **小团队**: 需要群组智能客服的小型团队
3. **企业用户**: 需要微信自动化处理的企业客户
4. **开发者**: 需要微信机器人开发框架的技术人员

## 核心功能需求

### 1. 智能对话系统
- **多平台AI集成**: 支持OpenAI、Coze、Dify、FastGPT、N8N、RAGFlow等平台
- **智能消息处理**: 
  - 文本消息：直接AI对话
  - 语音消息：语音转文字后AI处理
  - 图片消息：OCR识别后AI处理
  - 链接消息：提取URL内容后AI处理
  - 文件消息：下载并根据类型处理
- **上下文管理**: 维护对话上下文，提供连贯的对话体验
- **个性化回复**: 支持自定义prompt，定制机器人性格和回复风格

### 2. 消息监听与处理
- **用户监听**: 支持添加特定用户到监听列表
- **群组监听**: 支持群组消息监听，可配置@机器人才回复
- **实时处理**: 异步消息处理，支持高并发消息处理
- **消息过滤**: 支持消息免打扰、关键词过滤等功能

### 3. 配置管理系统
- **现代化UI**: 基于ttkbootstrap的现代化配置界面
- **多API管理**: 支持配置多个AI API，可设置默认API和用户专用API
- **监听规则**: 灵活的用户和群组监听规则配置
- **实时配置**: 配置修改实时生效，无需重启

### 4. 权限与安全
- **管理员系统**: 支持管理员权限，可通过消息指令管理机器人
- **用户权限**: 不同用户可配置不同的API和权限
- **群组管理**: 群组管理员权限，支持群组特定配置
- **安全防护**: 基于Windows官方API，不涉及微信客户端破解

## 技术架构需求

### 1. 核心技术栈
- **UI框架**: tkinter + ttkbootstrap (现代化界面)
- **微信自动化**: wxauto/wxautox (官方API，安全可靠)
- **异步处理**: asyncio + threading (高性能消息处理)
- **AI集成**: 多平台API适配器模式
- **配置管理**: JSON配置文件 + 实时加载

### 2. 系统架构
```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   UI管理界面    │    │   消息处理器    │    │   AI API集成    │
│  (main.py)     │────│(async_handler)  │────│  (API/*.py)     │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         │              ┌─────────────────┐              │
         └──────────────│   wxbot核心     │──────────────┘
                        │(wxbot_preview)  │
                        └─────────────────┘
                                 │
                        ┌─────────────────┐
                        │   微信客户端    │
                        │   (wxauto)      │
                        └─────────────────┘
```

### 3. 消息处理流程
```
微信消息 → 消息类型识别 → 内容提取 → AI处理 → 回复发送
    │           │           │         │         │
    │           │           │         │         └─ 异步发送队列
    │           │           │         └─ 多平台API调用
    │           │           └─ MessageProcessor处理
    │           └─ 文本/语音/图片/文件等类型
    └─ wxauto监听获取
```

## 功能特性需求

### 1. 消息类型支持
- [x] **文本消息**: 直接AI对话处理
- [x] **语音消息**: 语音转文字 + AI处理
- [x] **图片消息**: OCR识别 + AI处理 (可选)
- [x] **文件消息**: 文件下载 + 类型识别处理
- [x] **链接消息**: URL提取 + 内容分析
- [x] **位置消息**: 地址信息提取
- [x] **引用消息**: 引用内容 + 回复内容组合处理
- [x] **合并消息**: 展开消息内容处理
- [x] **名片消息**: 联系人信息处理
- [x] **表情消息**: 表情内容识别

### 2. AI平台集成
- [x] **OpenAI**: GPT系列模型支持
- [x] **Coze**: 字节跳动AI平台
- [x] **Dify**: 开源AI应用平台
- [x] **FastGPT**: 快速GPT部署平台
- [x] **N8N**: 工作流自动化平台
- [x] **RAGFlow**: RAG知识库平台
- [ ] **自定义API**: 支持用户自定义API接入

### 3. 高级功能
- [x] **异步处理**: 高并发消息处理，避免阻塞
- [x] **消息队列**: 消息排队处理，保证顺序
- [x] **错误重试**: API调用失败自动重试
- [x] **日志系统**: 完整的操作日志记录
- [x] **配置热更新**: 配置修改实时生效
- [ ] **插件系统**: 支持功能插件扩展
- [ ] **数据统计**: 使用统计和分析功能

## 用户体验需求

### 1. 界面设计
- **现代化UI**: 渐变色标题栏、卡片式布局、响应式设计
- **标签页管理**: API配置、机器人设置、监听规则、备忘录、控制面板、日志
- **实时反馈**: 操作状态实时显示，日志实时更新
- **友好提示**: 鼠标悬停提示，操作指引完善

### 2. 操作便捷性
- **一键启停**: 机器人一键启动/停止/重启
- **快速配置**: 图形化配置，无需手动编辑文件
- **批量操作**: 支持批量添加用户、群组等
- **导入导出**: 配置文件导入导出功能

### 3. 稳定性保障
- **异常处理**: 完善的异常捕获和处理机制
- **自动恢复**: 连接断开自动重连
- **状态监控**: 实时监控机器人运行状态
- **邮件通知**: 异常情况邮件通知管理员

## 部署与维护需求

### 1. 环境要求
- **操作系统**: Windows 10+ / Windows Server 2016+
- **Python版本**: 3.9-3.12
- **微信版本**: 3.9.8+ (不支持4.0)
- **依赖管理**: requirements.txt管理依赖

### 2. 部署方式
- **源码运行**: 直接运行Python源码
- **打包部署**: 打包成exe可执行文件
- **云服务器**: 支持云服务器部署 (需要图形界面)

### 3. 维护功能
- **配置备份**: 自动配置文件备份
- **日志轮转**: 日志文件自动轮转和清理
- **版本更新**: 支持版本检查和更新提示
- **性能监控**: 内存、CPU使用情况监控

## 安全与合规需求

### 1. 技术安全
- **官方API**: 基于Windows官方UIAutomation API
- **无侵入性**: 不涉及微信客户端破解或注入
- **数据安全**: 本地处理，不上传敏感信息
- **权限控制**: 严格的用户权限管理

### 2. 使用合规
- **个人使用**: 支持个人微信自动化需求
- **企业内部**: 支持企业内部使用
- **禁止商用**: 不允许商业化分发
- **合规提醒**: 使用风险提示和建议

## 扩展性需求

### 1. 功能扩展
- **插件架构**: 支持第三方插件开发
- **API扩展**: 新AI平台快速接入
- **消息类型**: 新消息类型处理扩展
- **自定义指令**: 用户自定义指令系统

### 2. 性能扩展
- **并发处理**: 支持更高并发消息处理
- **分布式**: 支持多实例分布式部署
- **负载均衡**: API调用负载均衡
- **缓存机制**: 智能缓存提升响应速度

## 项目里程碑

### Phase 1: 核心功能 (已完成)
- [x] 基础微信消息监听和回复
- [x] 多平台AI API集成
- [x] 现代化UI配置界面
- [x] 异步消息处理系统

### Phase 2: 增强功能 (当前)
- [x] 多消息类型处理 (MessageProcessor)
- [x] 消息内容智能提取
- [ ] 插件系统架构
- [ ] 性能优化和监控

### Phase 3: 企业级功能 (规划中)
- [ ] 分布式部署支持
- [ ] 高级权限管理
- [ ] 数据分析和统计
- [ ] 企业级安全增强

## 总结

dolphin_wxbot 项目旨在打造一个功能完善、易用性强、安全可靠的微信智能机器人系统。通过集成多个AI平台和支持多种消息类型处理，为用户提供智能化的微信自动化解决方案。项目采用现代化的技术架构和用户界面，确保良好的用户体验和系统稳定性。
